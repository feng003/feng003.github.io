<!DOCTYPE HTML>
<html>
    <head>
        <link rel="Stylesheet" type="text/css" href="/static/css/style.css">
        <link rel="Stylesheet" type="text/css" href="/static/css/tango.css">
        <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
        <link rel="icon" href="/favicon.ico" type="image/x-icon">
        <title>docker(5): build own image node  - wiki</title>
        <meta name="keywords" content="个人wiki"/>
        <meta name="description" content="个人wiki"/>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    </head>

    <body>
        <div id="container">
            
<div id="header">
  <div id="post-nav"><a href="/">Home</a>&nbsp;»&nbsp;<a href="/#linux">linux</a>&nbsp;»&nbsp;docker(5): build own image node </div>
</div>
<div class="clearfix"></div>
<div id="title">docker(5): build own image node </div>
  <div id="content">
  <blockquote>
<p>Dockerizing a Node.js web app</p>
</blockquote>
<h4 id="packagejson-serverjs">准备替换文件  package.json 和 server.js</h4>
<div class="hlcode"><pre><span class="kr">package</span><span class="p">.</span><span class="nx">json</span>

<span class="p">{</span>
      <span class="s2">&quot;name&quot;</span><span class="o">:</span> <span class="s2">&quot;docker_web_app&quot;</span><span class="p">,</span>
      <span class="s2">&quot;version&quot;</span><span class="o">:</span> <span class="s2">&quot;1.0.0&quot;</span><span class="p">,</span>
      <span class="s2">&quot;description&quot;</span><span class="o">:</span> <span class="s2">&quot;Node.js on Docker&quot;</span><span class="p">,</span>
      <span class="s2">&quot;author&quot;</span><span class="o">:</span> <span class="s2">&quot;zhang &lt;411152544@qq.com&gt;&quot;</span><span class="p">,</span>
      <span class="s2">&quot;main&quot;</span><span class="o">:</span> <span class="s2">&quot;server.js&quot;</span><span class="p">,</span>
      <span class="s2">&quot;scripts&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;start&quot;</span><span class="o">:</span> <span class="s2">&quot;node server.js&quot;</span>
      <span class="p">},</span>
      <span class="s2">&quot;dependencies&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;express&quot;</span><span class="o">:</span> <span class="s2">&quot;^4.13.3&quot;</span>
      <span class="p">}</span>
<span class="p">}</span>

<span class="nx">server</span><span class="p">.</span><span class="nx">js</span>

<span class="s1">&#39;use strict&#39;</span><span class="p">;</span>
<span class="kr">const</span> <span class="nx">express</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;express&#39;</span><span class="p">);</span>
<span class="c1">// Constants</span>
<span class="kr">const</span> <span class="nx">PORT</span> <span class="o">=</span> <span class="mi">8080</span><span class="p">;</span>
<span class="c1">// App</span>
<span class="kr">const</span> <span class="nx">app</span> <span class="o">=</span> <span class="nx">express</span><span class="p">();</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">res</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="s1">&#39;Hello world\n&#39;</span><span class="p">);</span>
<span class="p">});</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">listen</span><span class="p">(</span><span class="nx">PORT</span><span class="p">);</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Running on http://localhost:&#39;</span> <span class="o">+</span> <span class="nx">PORT</span><span class="p">);</span>
</pre></div>


<blockquote>
<p>Dockerfile</p>
</blockquote>
<div class="hlcode"><pre><span class="n">FROM</span> <span class="n">node</span><span class="o">:</span><span class="n">argon</span>

<span class="cp"># Create app directory</span>
<span class="n">RUN</span> <span class="n">mkdir</span> <span class="o">-</span><span class="n">p</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">app</span>
<span class="n">WORKDIR</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">app</span>

<span class="cp"># Install app dependencies</span>
<span class="n">COPY</span> <span class="n">package</span><span class="p">.</span><span class="n">json</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">app</span><span class="o">/</span>
<span class="n">RUN</span> <span class="n">npm</span> <span class="n">install</span>

<span class="cp"># Bundle app source</span>
<span class="n">COPY</span> <span class="p">.</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">app</span>

<span class="n">EXPOSE</span> <span class="mi">8080</span>
<span class="n">CMD</span> <span class="p">[</span> <span class="s">&quot;npm&quot;</span><span class="p">,</span> <span class="s">&quot;start&quot;</span> <span class="p">]</span>
</pre></div>


<blockquote>
<p>Build</p>
</blockquote>
<div class="hlcode"><pre><span class="n">docker</span> <span class="n">build</span> <span class="o">-</span><span class="n">t</span> <span class="n">feng003</span><span class="o">/</span><span class="n">node</span> <span class="p">.</span>
</pre></div>


<blockquote>
<p>tag and push</p>
</blockquote>
<div class="hlcode"><pre><span class="n">docker</span> <span class="n">tag</span> <span class="o">&lt;</span><span class="n">image</span> <span class="n">id</span><span class="o">&gt;</span> <span class="n">feng003</span><span class="o">/</span><span class="n">node</span><span class="o">:</span><span class="n">v1</span>
<span class="n">docker</span> <span class="n">login</span>
<span class="n">docker</span> <span class="n">push</span> <span class="n">feng003</span><span class="o">/</span><span class="n">node</span><span class="o">:</span><span class="n">v1</span>
</pre></div>


<blockquote>
<p>Run</p>
</blockquote>
<h4 id="docker-mapped-the-8080-port-inside-of-the-container-to-the-port-49160-on-your-machine">Docker mapped the 8080 port inside of the container to the port 49160 on your machine.</h4>
<div class="hlcode"><pre><span class="n">docker</span> <span class="n">run</span> <span class="o">-</span><span class="n">p</span> <span class="mi">49160</span><span class="o">:</span><span class="mi">8080</span> <span class="o">-</span><span class="n">d</span> <span class="n">feng003</span><span class="o">/</span><span class="n">node</span><span class="o">:</span><span class="n">v1</span>

<span class="n">docker</span> <span class="n">ps</span>  <span class="c1">//get container id</span>
<span class="n">docker</span> <span class="n">logs</span> <span class="o">&lt;</span><span class="n">container</span> <span class="n">id</span><span class="o">&gt;</span>  <span class="c1">// print app output</span>
<span class="n">curl</span> <span class="n">http</span><span class="o">:</span><span class="c1">//localhost:49160</span>
</pre></div>


<blockquote>
<p>exec  If you need to go inside the container</p>
</blockquote>
<div class="hlcode"><pre><span class="n">docker</span> <span class="n">exec</span> <span class="o">-</span><span class="n">it</span> <span class="o">&lt;</span><span class="n">container</span> <span class="n">id</span><span class="o">&gt;</span> <span class="o">/</span><span class="n">bin</span><span class="o">/</span><span class="n">bash</span>
</pre></div>


<p><a href="https://nodejs.org/en/docs/guides/nodejs-docker-webapp/">官网node</a></p>
</div>

        </div>
        <div id="footer">
            <span>
                Copyright © 2016 feng003.
                Powered by <a href="http://simiki.org/" target="_blank">Simiki</a>.
            </span>
        </div>
        
    </body>
</html>